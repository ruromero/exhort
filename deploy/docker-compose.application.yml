services:
  trust-da:
    image: ${TRUST_DA_IMAGE:-trust-da:latest}
    container_name: trustify-trust-da
    env_file:
      - .env
    ports:
      - "8080:8080"  # Application port
      - "9000:9000"  # Management port
    environment:
      # Monitoring
      MONITORING_ENABLED: "false"
      
      # Database
      DB_REDIS_HOST: redis
      DB_REDIS_PORT: 6379
      DB_POSTGRES_HOST: postgres
      DB_POSTGRES_PORT: 5432
      DB_POSTGRES_DATABASE: trustify
      DB_POSTGRES_USER: trustify
      DB_POSTGRES_PASSWORD: trustify123
      
      # Trustify
      PROVIDER_TRUSTIFY_HOST: ${TRUSTIFY_HOST:-https://trustify.example.com/api/v2/}
      PROVIDER_TRUSTIFY_AUTH_CLIENT_ID: ${TRUSTIFY_CLIENT_ID:-your-trustify-client-id}
      PROVIDER_TRUSTIFY_AUTH_CLIENT_SECRET: ${TRUSTIFY_CLIENT_SECRET:-your-trustify-client-secret}
      PROVIDER_TRUSTIFY_AUTH_SERVER_URL: ${TRUSTIFY_AUTH_SERVER_URL:-http://sso-trustify.example.com:8090}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/q/health/ready"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

networks:
  default:
    name: trustify-network
    external: true
